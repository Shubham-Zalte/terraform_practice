
Certainly! Below is a Terraform code snippet that creates an AWS Application Load Balancer (ALB) listener for handling HTTPS requests. This example assumes you have SSL/TLS certificates managed by AWS Certificate Manager (ACM) for HTTPS termination. Replace the placeholder values with your own specific details.

hcl
Copy code
provider "aws" {
  region = "us-east-1"  # Change to your desired region
}

# Create VPC, subnets, and security groups (if not already created)

# Create ALB
resource "aws_lb" "my_alb" {
  name               = "my-alb"
  internal           = false
  load_balancer_type = "application"
  security_groups    = [aws_security_group.alb_sg.id]
  subnets            = [aws_subnet.public_subnet_1.id, aws_subnet.public_subnet_2.id]

  enable_deletion_protection = false

  enable_http2 = true
}

# Create HTTPS listener
resource "aws_lb_listener" "https_listener" {
  load_balancer_arn = aws_lb.my_alb.arn
  port              = 443
  protocol          = "HTTPS"
  ssl_policy        = "ELBSecurityPolicy-2016-08"
  certificate_arn   = "arn:aws:acm:us-east-1:your-account-id:certificate/your-acm-certificate-arn"
}

# Create a default target group
resource "aws_lb_target_group" "default_target_group" {
  name     = "default-target-group"
  port     = 80
  protocol = "HTTP"
  vpc_id   = aws_vpc.my_vpc.id

  health_check {
    path     = "/"
    port     = "traffic-port"
    protocol = "HTTP"
  }
}

# Attach the default target group to the HTTPS listener
resource "aws_lb_listener_rule" "https_default_rule" {
  listener_arn = aws_lb_listener.https_listener.arn
  priority     = 100

  action {
    type             = "forward"
    target_group_arn = aws_lb_target_group.default_target_group.arn
  }
}

# Additional rules and target groups can be added for more sophisticated routing

# Create a security group for the ALB
resource "aws_security_group" "alb_sg" {
  vpc_id = aws_vpc.my_vpc.id

  # Define inbound and outbound rules for ALB security group
  # ...
}
In this code:

An ALB is created with an HTTPS listener on port 443.
The ssl_policy parameter specifies the SSL policy for the listener. You can choose an appropriate policy based on your security requirements.
The certificate_arn parameter should be replaced with the ARN of your ACM certificate. Make sure that the certificate is provisioned in the same region where you are creating the ALB.
A default target group is created to handle HTTP traffic on port 80.
The HTTPS listener is configured to forward traffic to the default target group.
Additional rules and target groups can be added for more sophisticated routing based on path patterns, host headers, etc.
A security group (aws_security_group.alb_sg) is assumed to be created separately and attached to the ALB.
This is a basic example, and you may need to customize it based on your specific requirements and security considerations. Ensure that you replace placeholder values and adapt the code to your production environment.